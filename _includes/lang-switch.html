{% comment %} Language switch component: shows EN/IT with active state. Works for posts (via ref) and for generic pages (like blog lists). {% endcomment %}
{% assign en = nil %}
{% assign it = nil %}
{% if page.ref %}
  {% assign en = site.posts | where: 'ref', page.ref | where: 'lang', 'en' | first %}
  {% assign it = site.posts | where: 'ref', page.ref | where: 'lang', 'it' | first %}
{% endif %}

<div class="lang-switch" aria-label="Language switch">
  {% if en or it %}
    {% if en %}
      {% if page.lang == 'en' %}
        <span class="lang-option active" lang="en">EN</span>
      {% else %}
        <a class="lang-option" href="{{ en.url | relative_url }}" hreflang="en" lang="en">EN</a>
      {% endif %}
    {% endif %}
    {% if en and it %}<span class="divider">/</span>{% endif %}
    {% if it %}
      {% if page.lang == 'it' %}
        <span class="lang-option active" lang="it">IT</span>
      {% else %}
        <a class="lang-option" href="{{ it.url | relative_url }}" hreflang="it" lang="it">IT</a>
      {% endif %}
    {% endif %}
  {% else %}
    {# Fallback for non-post pages like blog lists #}
    {% if page.lang == 'en' %}
      <span class="lang-option active" lang="en">EN</span>
      <span class="divider">/</span>
      <a class="lang-option" href="/blog/it/" hreflang="it" lang="it">IT</a>
    {% elsif page.lang == 'it' %}
      <a class="lang-option" href="/blog/en/" hreflang="en" lang="en">EN</a>
      <span class="divider">/</span>
      <span class="lang-option active" lang="it">IT</span>
    {% else %}
      <a class="lang-option" href="/blog/en/" hreflang="en" lang="en">EN</a>
      <span class="divider">/</span>
      <a class="lang-option" href="/blog/it/" hreflang="it" lang="it">IT</a>
    {% endif %}
  {% endif %}
</div>
